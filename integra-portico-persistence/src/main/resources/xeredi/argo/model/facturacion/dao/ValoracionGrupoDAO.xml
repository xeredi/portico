<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="xeredi.argo.model.facturacion.dao.ValoracionGrupoDAO">
    <resultMap type="ValoracionGrupoVO" id="ResultMap">
        <id column="vgrp_pk" />

        <result column="vgrp_pk" property="vgrpId" />

        <association property="pagador" javaType="ParametroVO">
            <id column="vlrc_pagador_prmt_pk" />

            <result column="vlrc_pagador_prmt_pk" property="id" />
        </association>

        <collection property="vlrcList" ofType="ValoracionVO" javaType="ArrayList">
            <id column="vlrc_pk" />

            <result column="vlrc_pk" property="id" />
            <result column="vlrc_fref" property="fref" />
            <result column="vlrc_fliq" property="fliq" />
            <result column="vlrc_es_suj_pasivo" property="sujPasivo" />
            <result column="vlrc_cod_exen" property="codExencion" />

            <result column="vlrc_info1" property="info1" />
            <result column="vlrc_info2" property="info2" />
            <result column="vlrc_info3" property="info3" />
            <result column="vlrc_info4" property="info4" />
            <result column="vlrc_info5" property="info5" />
            <result column="vlrc_info6" property="info6" />

            <association property="srvc" javaType="ServicioVO">
                <id column="vlrc_srvc_pk" />

                <result column="vlrc_srvc_pk" property="id" />
            </association>

            <association property="pagador" javaType="ParametroVO">
                <id column="vlrc_pagador_prmt_pk" />

                <result column="vlrc_pagador_prmt_pk" property="id" />
            </association>
        </collection>
    </resultMap>

    <select id="selectList" parameterType="ValoracionGrupoCriterioVO" resultMap="ResultMap">
        SELECT
        <choose>
            <when test="grupoTipo == 'P'">vlrc_pagador_prmt_pk</when>
            <when test="grupoTipo == 'T'">srvc_tpsr_pk</when>
            <when test="grupoTipo == 'S'">vlrc_srvc_pk</when>
        </choose>
    <![CDATA[
                AS vgrp_pk
            , vlrc_pk
            , vlrc_fref, vlrc_fini, vlrc_ffin, vlrc_fliq
            , vlrc_es_suj_pasivo, vlrc_cod_exen

            , vlrc_info1, vlrc_info2, vlrc_info3, vlrc_info4, vlrc_info5, vlrc_info6
            , vlrc_srvc_pk, vlrc_pagador_prmt_pk
        FROM tbl_valoracion_vlrc
            INNER JOIN tbl_servicio_srvc ON
                srvc_pk = vlrc_srvc_pk
        WHERE
            vlrc_fctr_pk IS NULL
    ]]>
        <if test="pagador != null and pagador.id != null">
            AND vlrc_pagador_prmt_pk = #{pagador.id}
        </if>
        <if test="tpsr != null and tpsr.id != null">
            AND srvc_tpsr_pk = #{tpsr.id}
        </if>
        <if test="prto != null and prto.id != null">
            AND srvc_subp_pk = #{prto.id}
        </if>
        <if test="srvc != null and srvc.id != null">
            AND vlrc_srvc_pk = #{srvc.id}
        </if>
        <if test="vlrc != null and vlrc.id != null">
            AND vlrc_pk = #{vlrc.id}
        </if>
    <![CDATA[
        ORDER BY vlrc_pagador_prmt_pk, srvc_tpsr_pk, srvc_pk, vlrc_pk
    ]]>
    </select>
</mapper>
