<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="xeredi.integra.model.servicio.dao.ServicioTramiteDAO">
	<resultMap type="ServicioTramiteVO" id="ResultMap">
		<id column="srtr_pk" />

		<result column="srtr_pk" property="id" />
		<result column="srtr_srvc_pk" property="srvcId" />
		<result column="srtr_falta" property="fecha" />
		<result column="srvc_fref" property="fref" />

		<association property="trmt" javaType="TramiteVO">
			<result column="srtr_trmt_pk" property="id" />
			<result column="trmt_estado_orig" property="estadoOrig" />
			<result column="trmt_estado_dest" property="estadoDest" />
			<result column="trmt_enti_pk" property="entiId" />
		</association>
	</resultMap>

	<sql id="SelectPrefix">
    <![CDATA[
		SELECT
			srtr_pk, srtr_srvc_pk, srtr_falta, srtr_trmt_pk

			, trmt_estado_orig, trmt_estado_dest, trmt_enti_pk

			, srvc_fref
		FROM
			tbl_servicio_tramite_srtr
			INNER JOIN tbl_tramite_trmt ON
				trmt_pk = srtr_trmt_pk
			INNER JOIN tbl_servicio_srvc ON
				srvc_pk = srtr_srvc_pk
	]]>
	</sql>

	<sql id="SelectWhere">
		<where>
			<if test="id != null">
				AND srtr_pk = #{id}
			</if>
			<if test="srvcId != null">
				AND srtr_srvc_pk = #{srvcId}
			</if>
		</where>
	</sql>

	<select id="selectList" parameterType="ServicioTramiteCriterioVO" resultMap="ResultMap">
		<include refid="SelectPrefix" />
		<include refid="SelectWhere" />
		ORDER BY srtr_srvc_pk, srtr_falta
	</select>

	<select id="selectObject" parameterType="ServicioTramiteCriterioVO" resultMap="ResultMap">
		<include refid="SelectPrefix" />
		<include refid="SelectWhere" />
	</select>

	<insert id="insert" parameterType="ServicioTramiteVO">
        <![CDATA[
        INSERT INTO tbl_servicio_tramite_srtr (srtr_pk, srtr_srvc_pk, srtr_trmt_pk, srtr_falta)
        VALUES (#{id}, #{srvcId}, #{trmt.id}, #{fecha})
        ]]>
	</insert>

	<delete id="deleteList" parameterType="ServicioTramiteCriterioVO">
		DELETE FROM tbl_servicio_tramite_srtr
		<include refid="SelectWhere" />
	</delete>
</mapper>
