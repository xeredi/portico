<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="xeredi.integra.model.dao.facturacion.AspectoDAO">
    <resultMap type="AspectoVO" id="ResultMap">
        <id column="aspv_pk" />
        <result column="aspc_pk" property="id" />
        <result column="aspc_codigo" property="codigo" />
        <result column="aspc_descripcion" property="descripcion" />

        <association property="tpsr" javaType="TipoServicioVO">
            <result column="aspc_tpsr_pk" property="id" />
        </association>

        <association property="aspv" javaType="AspectoVersionVO">
            <result column="aspv_pk" property="id" />
            <result column="aspv_fini" property="fini" />
            <result column="aspv_ffin" property="ffin" />

            <result column="aspv_cpath_info1" property="cpathInfo1" />
            <result column="aspv_cetiq_info1" property="cetiqInfo1" />
            <result column="aspv_cpath_info2" property="cpathInfo2" />
            <result column="aspv_cetiq_info2" property="cetiqInfo2" />
            <result column="aspv_cpath_info3" property="cpathInfo3" />
            <result column="aspv_cetiq_info3" property="cetiqInfo3" />
            <result column="aspv_cpath_info4" property="cpathInfo4" />
            <result column="aspv_cetiq_info4" property="cetiqInfo4" />
            <result column="aspv_cpath_info5" property="cpathInfo5" />
            <result column="aspv_cetiq_info5" property="cetiqInfo5" />
            <result column="aspv_cpath_info6" property="cpathInfo6" />
            <result column="aspv_cetiq_info6" property="cetiqInfo6" />

            <result column="aspv_lsum_cuant1" property="lsumCuant1" />
            <result column="aspv_lsum_cuant2" property="lsumCuant2" />
            <result column="aspv_lsum_cuant3" property="lsumCuant3" />
            <result column="aspv_lsum_cuant4" property="lsumCuant4" />
            <result column="aspv_lsum_cuant5" property="lsumCuant5" />
            <result column="aspv_lsum_cuant6" property="lsumCuant6" />

            <result column="aspv_lgrp_cuant1" property="lgrpCuant1" />
            <result column="aspv_lgrp_cuant2" property="lgrpCuant2" />
            <result column="aspv_lgrp_cuant3" property="lgrpCuant3" />
            <result column="aspv_lgrp_cuant4" property="lgrpCuant4" />
            <result column="aspv_lgrp_cuant5" property="lgrpCuant5" />
            <result column="aspv_lgrp_cuant6" property="lgrpCuant6" />

            <result column="aspv_lgrp_info1" property="lgrpInfo1" />
            <result column="aspv_lgrp_info2" property="lgrpInfo2" />
            <result column="aspv_lgrp_info3" property="lgrpInfo3" />
            <result column="aspv_lgrp_info4" property="lgrpInfo4" />
            <result column="aspv_lgrp_info5" property="lgrpInfo5" />
            <result column="aspv_lgrp_info6" property="lgrpInfo6" />
        </association>
    </resultMap>

    <sql id="SelectPrefix">
    <![CDATA[
        SELECT
        	aspc_pk, aspc_codigo, aspc_tpsr_pk, aspc_descripcion
        	, aspv_pk, aspv_fini, aspv_ffin
        	, aspv_cpath_info1, aspv_cetiq_info1, aspv_cpath_info2, aspv_cetiq_info2, aspv_cpath_info3, aspv_cetiq_info3
        	, aspv_cpath_info4, aspv_cetiq_info4, aspv_cpath_info5, aspv_cetiq_info5, aspv_cpath_info6, aspv_cetiq_info6
        	, aspv_lsum_cuant1, aspv_lsum_cuant2, aspv_lsum_cuant3, aspv_lsum_cuant4, aspv_lsum_cuant5, aspv_lsum_cuant6
        	, aspv_lgrp_cuant1, aspv_lgrp_cuant2, aspv_lgrp_cuant3, aspv_lgrp_cuant4, aspv_lgrp_cuant5, aspv_lgrp_cuant6
        	, aspv_lgrp_info1, aspv_lgrp_info2, aspv_lgrp_info3, aspv_lgrp_info4, aspv_lgrp_info5, aspv_lgrp_info6
        from tbl_aspecto_aspc
        	JOIN tbl_aspecto_version_aspv ON
        		aspv_aspc_pk = aspc_pk
    ]]>
    </sql>

    <sql id="SelectWhere">
        <where>
            <if test="fechaVigencia != null">
                AND #{fechaVigencia} BETWEEN aspv_fini AND COALESCE(aspv_ffin, #{fechaVigencia})
            </if>

            <if test="id != null">
                AND aspc_pk = #{id}
            </if>

            <if test="srvcId != null">
                AND EXISTS (
            		SELECT 1
            		FROM tbl_servicio_srvc
            		WHERE srvc_tpsr_pk = aspc_tpsr_pk
            			AND srvc_pk = #{srvcId}
            	)
            </if>
        </where>
    </sql>

    <select id="selectList" parameterType="AspectoCriterioVO" resultMap="ResultMap">
        <include refid="SelectPrefix" />
        <include refid="SelectWhere" />
    </select>
</mapper>
