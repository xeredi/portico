<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="xeredi.integra.model.dao.facturacion.FacturaCargoDAO">
    <resultMap type="FacturaCargoVO" id="ResultMap">
        <id column="fctc_fctr_pk" />
        <id column="fctc_crgo_pk" />

        <result column="fctc_fctr_pk" property="fctrId" />
        <association property="crgo" resultMap="xeredi.integra.model.dao.facturacion.CargoDAO.ResultMap" />
    </resultMap>

    <sql id="SelectWhere">
        <where>
            <if test="id != null">
                AND fctc_fctr_pk = #{id}
            </if>
            <if test="ids != null">
                AND fctc_fctr_pk IN
                <foreach collection="ids" item="item" open="(" close=")" separator=",">#{item}
                </foreach>
            </if>
        </where>
    </sql>

    <insert id="insertGenerate" parameterType="FacturaCriterioVO">
    <![CDATA[
        INSERT INTO tbl_factura_cargo_fctc (fctc_fctr_pk, fctc_crgo_pk)
        	SELECT fctr_pk, crgo_pk
        	FROM tbl_cargo_crgo, tbl_factura_fctr
        	WHERE
        		EXISTS (
        			SELECT 1
        			FROM tbl_regla_rgla
        			WHERE
        				rgla_crgo_pk = crgo_pk
        				AND EXISTS (
        					SELECT 1
        					FROM tbl_factura_lin_fctl
        					WHERE
        						fctl_rgla_pk = rgla_pk
        						AND fctl_fctr_pk = fctr_pk
        				)
        		)
        		AND fctr_pk = #{id}
    ]]>
    </insert>
</mapper>
