<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="xeredi.integra.model.dao.facturacion.ValoracionDAO">

    <insert id="insert" parameterType="ValoracionVO">
    <![CDATA[
        INSERT INTO tbl_valoracion_vlrc (
            vlrc_pk, vlrc_srvc_pk, vlrc_aspc_pk, vlrc_pagador_pk
            , vlrc_fref, vlrc_fliq, vlrc_falta, vlrc_fini, vlrc_ffin
            , vlrc_importe, vlrc_iva, vlrc_es_suj_pasivo, vlrc_cod_exen
            , vlrc_info1, vlrc_info2, vlrc_info3, vlrc_info4, vlrc_info5, vlrc_info6
        )
        VALUES (
            #{id}, #{srvc.id}, #{aspc.id}, #{pagador.id}
            , #{fref}, #{fliq}, #{falta}, #{fini}, #{ffin}
            , #{importe}, #{iva}, #{sujPasivo, jdbcType=INTEGER, javaType=Boolean}, #{codExencion}
            , #{info1}, #{info2}, #{info3}, #{info4}, #{info5}, #{info6}
        )
    ]]>
    </insert>

    <insert id="insertGenerateCargos" parameterType="ValoracionCriterioVO">
    <![CDATA[
        INSERT INTO tbl_valoracion_cargo_vlrg (vlrg_vlrc_pk, vlrg_crgo_pk)
            SELECT vlrc_pk, crgo_pk
            FROM tbl_valoracion_vlrc
                , tbl_cargo_crgo
            WHERE
                EXISTS (
        		    SELECT 1
		            FROM tbl_regla_rgla
		            WHERE
			            rgla_crgo_pk = crgo_pk
			            AND EXISTS (
			                SELECT 1
			                FROM tbl_valoracion_lin_vlrl
			                WHERE
				                vlrl_rgla_pk = rgla_pk
				                AND vlrl_vlrc_pk = vlrc_pk
                        )
                        AND vlrc_pk = #{id}
                )
    ]]>
    </insert>
</mapper>
