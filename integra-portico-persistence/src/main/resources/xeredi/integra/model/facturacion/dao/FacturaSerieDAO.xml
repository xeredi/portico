<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="xeredi.integra.model.facturacion.dao.FacturaSerieDAO">
    <resultMap type="FacturaSerieVO" id="ResultMap">
        <id column="fcsr_pk" />
        <result column="fcsr_pk" property="id" />
        <result column="fcsr_serie" property="serie" />
        <result column="fcsr_anio" property="anio" />
        <result column="fcsr_numero_ultimo" property="numeroUltimo" />
    </resultMap>

    <sql id="SelectPrefix">
    <![CDATA[
        SELECT fcsr_pk, fcsr_serie, fcsr_anio, fcsr_numero_ultimo
        FROM tbl_factura_serie_fcsr
    ]]>
    </sql>

    <sql id="SelectWhere">
    	<where>
    		<if test="anio != null">
    			AND fcsr_anio = #{anio}
    		</if>
    	</where>
    </sql>

    <select id="select" parameterType="Long" resultMap="ResultMap">
        <include refid="SelectPrefix" />
        WHERE fcsr_pk = #{value}
    </select>

    <select id="count" parameterType="FacturaSerieCriterioVO" resultType="Integer">
    	SELECT COUNT(1) FROM tbl_factura_serie_fcsr
        <include refid="SelectWhere" />
    </select>

    <select id="selectList" parameterType="FacturaSerieCriterioVO" resultMap="ResultMap">
        <include refid="SelectPrefix" />
        <include refid="SelectWhere" />
        ORDER BY fcsr_anio DESC, fcsr_serie
    </select>

    <select id="selectLabelValueList" parameterType="FacturaSerieCriterioVO" resultType="LabelValueVO">
    <![CDATA[
    	SELECT
    		fcsr_pk AS value
    		, CONCAT(CONCAT(fcsr_serie, ' - '), fcsr_anio) AS label
    	FROM tbl_factura_serie_fcsr
    ]]>
        <include refid="SelectWhere" />
    </select>

    <select id="exists" parameterType="FacturaSerieVO" resultType="Boolean">
    <![CDATA[
    	SELECT COUNT(1)
    	FROM tbl_factura_serie_fcsr
    	WHERE
    		fcsr_serie = #{serie}
    		AND fcsr_anio = #{anio}
    ]]>
    </select>

	<insert id="insert" parameterType="FacturaSerieVO">
    <![CDATA[
    	INSERT INTO tbl_factura_serie_fcsr(fcsr_pk, fcsr_serie, fcsr_anio, fcsr_numero_ultimo)
    	VALUES(#{id}, #{serie}, #{anio}, #{numeroUltimo})
    ]]>
	</insert>

	<update id="update" parameterType="FacturaSerieVO">
    <![CDATA[
    	UPDATE tbl_factura_serie_fcsr SET
    		fcsr_numero_ultimo = #{numeroUltimo}
    	WHERE fcsr_pk = #{id}
    ]]>
	</update>

	<delete id="delete" parameterType="Long">
    <![CDATA[
    	DELETE FROM tbl_factura_serie_fcsr
    	WHERE fcsr_pk = #{value}
    ]]>
	</delete>

    <update id="updateIncrementar" parameterType="Long">
    <![CDATA[
        UPDATE tbl_factura_serie_fcsr SET
            fcsr_numero_ultimo = fcsr_numero_ultimo +1
        WHERE fcsr_pk = #{value}
    ]]>
    </update>
</mapper>
